<!DOCTYPE html>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const videoUrl = urlParams.get('videoUrl');  // 获取如 ?videoUrl=https://cdn2.gzsg.org/upload/tinymce/1744618564375.mp4
</script>
<video id="myVideo" controls crossorigin="anonymous"></video>
<p id="durationDisplay">视频加载中...</p>

<script>
    const video = document.getElementById('myVideo');
    video.src = videoUrl;

    video.addEventListener('loadedmetadata', async function () {
        const duration = video.duration;
        const hours = Math.floor(duration / 3600);
        const minutes = Math.floor((duration % 3600) / 60);
        const secs = Math.floor(duration % 60);
        const pad = (num) => num.toString().padStart(2, '0');
        const tim = `${pad(hours)}:${pad(minutes)}:${pad(secs)}`;
        document.getElementById('durationDisplay').textContent = 
            `视频时长：${tim}, 总秒数：${duration}秒`;

        // 发送时长到服务端，服务端通过响应头返回
        const response = await fetch('http://localhost:3000/get-duration', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ duration, videoUrl })
        });
        
        // 从响应头读取服务端返回的时长
        const durationHeader = response.headers.get('X-Video-Duration');
        console.log('响应头中的时长:', durationHeader);
    });
</script>
