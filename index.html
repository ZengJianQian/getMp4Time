<!DOCTYPE html>
<html>
<head>
    <title>视频时长推送</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #status { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>视频时长检测</h1>
    <div>
        <video id="myVideo" controls crossorigin="anonymous" width="100%"></video>
        <p id="durationDisplay">视频加载中...</p>
        <div id="status"></div>
    </div>

<script>
    // 配置项 - 替换为你的Webhook地址和可选密钥
    const WEBHOOK_URL = 'https://your-server.com/api/webhook'; // 你的Webhook接收地址
    const SECRET_TOKEN = 'your-optional-secret'; // 可选：用于验证请求

    // 从URL参数获取视频地址
    const urlParams = new URLSearchParams(window.location.search);
    const videoUrl = urlParams.get('videoUrl');

    // 格式化时长为 HH:MM:SS
    function formatDuration(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = Math.floor(seconds % 60);
        
        return [
            hours.toString().padStart(2, '0'),
            minutes.toString().padStart(2, '0'),
            secs.toString().padStart(2, '0')
        ].join(':');
    }

    // 发送数据到Webhook
    async function sendWebhook(data) {
        const payload = {
            videoUrl: videoUrl,
            durationSeconds: data.duration,
            formattedDuration: data.formatted,
            timestamp: new Date().toISOString()
        };

        try {
            const response = await fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${SECRET_TOKEN}` // 可选认证
                },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            updateStatus(`数据已发送到服务器 (状态: ${response.status})`, 'success');
            console.log('Webhook响应:', result);
        } catch (error) {
            updateStatus(`发送失败: ${error.message}`, 'error');
            console.error('Webhook错误:', error);
        }
    }

    // 更新页面状态显示
    function updateStatus(message, type) {
        const statusEl = document.getElementById('status');
        statusEl.textContent = message;
        statusEl.className = type;
    }

    // 主逻辑
    const video = document.getElementById('myVideo');
    if (videoUrl) {
        video.src = videoUrl;
        
        video.addEventListener('loadedmetadata', function() {
            const duration = video.duration;
            if (isNaN(duration)) {
                const errorMsg = '无法获取视频时长';
                document.getElementById('durationDisplay').textContent = errorMsg;
                updateStatus(errorMsg, 'error');
                return;
            }
            
            const formatted = formatDuration(duration);
            document.getElementById('durationDisplay').textContent = 
                `视频时长：${formatted}, 总秒数：${duration.toFixed(2)}秒`;

            // 发送数据到Webhook
            sendWebhook({
                duration: duration,
                formatted: formatted
            });
        });
        
        video.addEventListener('error', function() {
            const errorMsg = '视频加载失败，请检查URL有效性';
            document.getElementById('durationDisplay').textContent = errorMsg;
            updateStatus(errorMsg, 'error');
        });
    } else {
        const errorMsg = '未提供视频URL参数，请使用?videoUrl=xxx格式';
        document.getElementById('durationDisplay').textContent = errorMsg;
        updateStatus(errorMsg, 'error');
    }
</script>
</body>
</html>
